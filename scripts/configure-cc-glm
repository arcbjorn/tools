#!/bin/bash

# Script to configure Claude GLM function in shell/rc

echo "This script will add a 'glm' function to your shell configuration that uses api.z.ai"
echo

# Ask for auth token
read -s -p "Enter your ANTHROPIC_AUTH_TOKEN: " auth_token
echo

if [ -z "$auth_token" ]; then
    echo "Error: Auth token cannot be empty"
    exit 1
fi

# Check if function already exists
SHELL_TEMP="$HOME/tools/shell/temp"
if grep -q "^glm()" "$SHELL_TEMP"; then
    echo "glm() function already exists in shell configuration"
    read -p "Do you want to replace it? (y/N): " replace
    if [[ ! $replace =~ ^[Yy]$ ]]; then
        echo "Aborted."
        exit 0
    fi
    # Remove existing function and export
    sed -i '/^glm()/,/^}/d' "$SHELL_TEMP"
    sed -i '/^export -f glm$/d' "$SHELL_TEMP"
fi

# Add the function to shell/temp
cat >> "$SHELL_TEMP" << EOF

# Claude GLM function
glm() {
    ANTHROPIC_BASE_URL=https://api.z.ai/api/anthropic ANTHROPIC_AUTH_TOKEN=$auth_token ANTHROPIC_MODEL="glm-4.6" claude "\$@"
}
export -f glm
EOF

echo "âœ“ Added glm() function to shell/temp configuration"
echo "Run 'source ~/.bashrc' or start a new terminal to use it"
echo
echo "Usage: glm [claude arguments]"
echo "Example: glm --help"
echo
echo "Documentation: https://docs.z.ai/scenario-example/develop-tools/claude"